<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bishe.dao.CommentDAO">
    <resultMap id="commentResultMap" type="com.bishe.dataobject.CommentDO">
        <id column="id" property="id"/>
        <result column="content" property="content"/>
        <result column="author_id" property="authorId"/>
        <result column="father_name" property="fatherName"/>
        <result column="like_num" property="likeNum"/>
        <result column="dynamic_id" property="dynamicId"/>
        <result column="gmt_created" property="gmtCreated"/>
        <result column="gmt_modified" property="gmtModified"/>
    </resultMap>

    <insert id="add" parameterType="com.bishe.dataobject.CommentDO">
        INSERT INTO `comment` (id, content, author_id, father_name, like_num, dynamic_id, gmt_created, gmt_modified)
            VALUE (#{id}, #{content}, #{authorId}, #{fatherName}, #{likeNum}, #{dynamicId}, now(), now());
    </insert>

    <update id="update" parameterType="com.bishe.dataobject.CommentDO">
        UPDATE `comment`
        <set>
            <if test="content != null and content != ''">
                content = #{content},
            </if>
            <if test="authorId != null">
                author_id = #{authorId},
            </if>
            <if test="fatherName != null and fatherName != ''">
                father_name = #{fatherName},
            </if>
            <if test="likeNum != null">
                like_num = #{likeNum},
            </if>
            <if test="dynamicId != null">
                dynamic_id = #{dynamicId},
            </if>
            <if test="gmtCreated != null">
                gmt_created = #{gmtCreated,jdbcType=TIMESTAMP},
            </if>
            gmt_modified = now()
        </set>
        <where>
            <if test="id != null">
                id = #{id}
            </if>
        </where>
    </update>

    <select id="findByAuthorId" resultMap="commentResultMap">
        SELECT id, content, author_id, father_name, like_num, dynamic_id, gmt_created, gmt_modified
        FROM `comment`
        <where>
            <if test="authorId != null">
                author_id = #{authorId}
            </if>
        </where>
        ORDER BY
        like_num DESC
        limit #{start},#{limit}
    </select>


    <select id="findByDynamicId" resultMap="commentResultMap">
        SELECT id, content, author_id, father_name, like_num, dynamic_id, gmt_created, gmt_modified
        FROM `comment`
        <where>
            <if test="dynamicId != null">
                dynamic_id = #{dynamicId}
            </if>
        </where>
        ORDER BY
        like_num DESC
        limit #{start},#{limit}
    </select>

    <update id="addLikeNum" parameterType="java.lang.Long">
        UPDATE `comment`
        <set>
            <if test="commentId != null">
                like_num = like_num + 1
            </if>
        </set>
        <where>
            <if test="commentId != null">
                id = #{commentId}
            </if>
        </where>
    </update>

    <update id="decLikeNum" parameterType="java.lang.Long">
        UPDATE `comment`
        <set>
            <if test="commentId != null">
                like_num = like_num - 1
            </if>
        </set>
        <where>
            <if test="commentId != null">
                id = #{commentId}
            </if>
        </where>
    </update>


</mapper>